<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ace - Pronunciation Coach</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .mic-active { animation: pulse 1.5s infinite; background-color: #ef4444 !important; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .phonetic-box { background: rgba(59, 130, 246, 0.1); border-left: 4px solid #3b82f6; }
    </style>
</head>
<body class="bg-[#0f172a] text-slate-200 min-h-screen flex flex-col font-sans">

    <header class="p-4 border-b border-slate-800 bg-[#1e293b] flex justify-between items-center shadow-xl">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-red-500 rounded-full flex items-center justify-center shadow-lg">
                <i class="fas fa-microchip text-white"></i>
            </div>
            <h1 class="font-bold text-lg tracking-tight">Ace <span class="text-blue-400">Coach</span></h1>
        </div>
        <div id="streak" class="text-orange-400 font-bold text-sm">üî• <span id="points">0</span> pts</div>
    </header>

    <main class="flex-1 overflow-y-auto p-4 space-y-4" id="chat-window">
        <div class="bg-slate-800 p-4 rounded-2xl max-w-[90%] shadow-md">
            <p class="text-blue-300 text-xs font-bold mb-1 uppercase">Ace Assistant</p>
            <p>¬°Hola! Soy tu coach nativo. Dime cualquier frase en ingl√©s. Si pronuncias mal una palabra t√©cnica o com√∫n, te ense√±ar√© c√≥mo decirla usando fon√©tica en espa√±ol.</p>
        </div>
    </main>

    <div id="correction-panel" class="hidden p-4 bg-slate-900 border-t border-blue-900/50">
        <h3 class="text-blue-400 text-xs font-bold uppercase mb-2">Gu√≠a de Pronunciaci√≥n:</h3>
        <div id="phonetic-list" class="space-y-2">
            </div>
    </div>

    <footer class="p-6 border-t border-slate-800 bg-[#1e293b] flex flex-col items-center">
        <p id="status" class="text-sm text-slate-400 mb-4 italic">Haz clic para hablar...</p>
        <button onclick="startListening()" id="mic-btn" class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center text-3xl shadow-2xl hover:scale-105 transition-all">
            <i class="fas fa-microphone"></i>
        </button>
    </footer>

    <script>
        // Diccionario Fon√©tico Personalizado (Espa√±ol)
        const phoneticDb = {
            "maintenance": "m√©in-te-nans",
            "schedule": "sh√©-diul",
            "honing": "j√≥-nin",
            "calibration": "ka-li-br√©i-shon",
            "troubleshooting": "tr√≥-bol-sh√∫-tin",
            "machine": "ma-sh√≠n",
            "sensor": "s√©n-sor",
            "technical": "t√©k-ni-kal",
            "interview": "√≠n-ter-viu",
            "salary": "s√°-la-ri",
            "poisson": "pua-s√≥n",
            "distribution": "dis-tri-bi√∫-shon",
            "betting": "b√©-tin",
            "odds": "ods",
            "engineer": "en-yi-n√≠er",
            "fault": "folt",
            "breaker": "br√©i-ker",
            "leak": "lik"
        };

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';
        recognition.interimResults = false;

        function addMessage(text, isUser = false) {
            const chat = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.className = `flex flex-col ${isUser ? 'items-end ml-auto' : 'items-start'} max-w-[90%] animation-slide-up`;
            div.innerHTML = `
                <div class="${isUser ? 'bg-blue-600' : 'bg-slate-800'} p-3 rounded-2xl shadow-lg">
                    ${text}
                </div>
            `;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function startListening() {
            recognition.start();
            document.getElementById('mic-btn').classList.add('mic-active');
            document.getElementById('status').innerText = "Escuchando...";
            document.getElementById('correction-panel').classList.add('hidden');
        }

        recognition.onresult = (event) => {
            const text = event.results[0][0].transcript.toLowerCase();
            const confidence = event.results[0][0].confidence;
            document.getElementById('mic-btn').classList.remove('mic-active');
            
            addMessage(text, true);
            analyzePronunciation(text, confidence);
        };

        function analyzePronunciation(text, confidence) {
            const words = text.split(' ');
            const panel = document.getElementById('correction-panel');
            const list = document.getElementById('phonetic-list');
            list.innerHTML = '';
            let found = false;

            words.forEach(word => {
                if (phoneticDb[word]) {
                    found = true;
                    const div = document.createElement('div');
                    div.className = "phonetic-box p-2 rounded bg-blue-500/10 flex justify-between items-center";
                    div.innerHTML = `
                        <span class="font-bold text-white">${word}</span>
                        <span class="text-blue-400 font-mono text-lg">${phoneticDb[word]}</span>
                    `;
                    list.appendChild(div);
                }
            });

            // Si la confianza es baja, sugerir pr√°ctica general
            if (confidence < 0.85) {
                found = true;
                const tip = document.createElement('p');
                tip.className = "text-xs text-slate-400 italic mt-2";
                tip.innerText = "Nota: Te entend√≠, pero tu pronunciaci√≥n fue un poco d√©bil. ¬°Intenta exagerar m√°s los sonidos!";
                list.appendChild(tip);
            }

            if (found) {
                panel.classList.remove('hidden');
                speak("Let's check your pronunciation.");
            } else {
                speak("Good job! That sounded clear.");
            }
            
            document.getElementById('status').innerText = "Listo.";
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
