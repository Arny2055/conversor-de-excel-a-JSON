<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ace - Native English Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .mic-active { animation: pulse 1.5s infinite; background-color: #ef4444 !important; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .chat-bubble { border-radius: 20px; position: relative; }
    </style>
</head>
<body class="bg-[#0f172a] text-slate-200 min-h-screen flex flex-col font-sans">

    <header class="p-6 border-b border-slate-800 flex justify-between items-center bg-[#1e293b]">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center shadow-lg shadow-blue-500/30">
                <i class="fas fa-robot text-white"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg">Ace</h1>
                <p class="text-xs text-green-400 flex items-center gap-1"><span class="w-2 h-2 bg-green-500 rounded-full"></span> Native Assistant</p>
            </div>
        </div>
        <select id="topic-selector" onchange="changeTopic()" class="bg-slate-800 border border-slate-700 text-sm rounded-lg p-2 outline-none focus:ring-2 ring-blue-500">
            <option value="general">Daily Life (General)</option>
            <option value="technical">Engineering & Maintenance</option>
            <option value="sports">Sports & Betting Analysis</option>
            <option value="business">Job Interviews / Business</option>
        </select>
    </header>

    <main id="chat-window" class="flex-1 overflow-y-auto p-6 space-y-6 flex flex-col">
        <div class="flex flex-col items-start max-w-[80%]">
            <div class="bg-slate-800 p-4 chat-bubble text-slate-200 shadow-md">
                Hello! I'm Ace, your native American assistant. Ready to practice speaking? Select a topic above and click the mic to start.
            </div>
            <span class="text-[10px] mt-1 ml-2 text-slate-500">ACE • NOW</span>
        </div>
    </main>

    <footer class="p-8 border-t border-slate-800 bg-[#1e293b] flex flex-col items-center">
        <div id="status-text" class="mb-4 text-sm text-blue-400 font-medium h-6">Click the mic and say something...</div>
        
        <div class="flex items-center gap-8">
            <button onclick="startListening()" id="mic-btn" class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center text-3xl shadow-xl hover:bg-blue-500 transition-all active:scale-95">
                <i class="fas fa-microphone"></i>
            </button>
        </div>
        
        <p class="mt-6 text-xs text-slate-500 text-center max-w-xs">
            "Your English improves by 1% every time you speak out loud."
        </p>
    </footer>

    <script>
        // Configuración de Voz (Native American English)
        const synth = window.speechSynthesis;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        
        recognition.lang = 'en-US';
        recognition.interimResults = false;

        const chatWindow = document.getElementById('chat-window');
        const statusText = document.getElementById('status-text');
        const micBtn = document.getElementById('mic-btn');

        const scenarios = {
            general: ["How's your day going so far?", "What are your plans for the weekend?", "Tell me about a place you'd love to visit."],
            technical: ["Describe the process of a machine overhaul.", "What is the most common fault in a Gleason machine?", "Explain the importance of sensor calibration."],
            sports: ["Which team do you think has the edge tonight?", "How do you use Poisson distribution for betting?", "What's your take on dropping odds?"],
            business: ["Tell me about your experience as a technician.", "Why are you looking for a new job at IMSS?", "What are your salary expectations?"]
        };

        function addMessage(text, isUser = false) {
            const div = document.createElement('div');
            div.className = `flex flex-col ${isUser ? 'items-end ml-auto' : 'items-start'} max-w-[80%]`;
            div.innerHTML = `
                <div class="${isUser ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-200'} p-4 chat-bubble shadow-md">
                    ${text}
                </div>
                <span class="text-[10px] mt-1 mx-2 text-slate-500 uppercase tracking-widest">${isUser ? 'You' : 'Ace'}</span>
            `;
            chatWindow.appendChild(div);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = synth.getVoices();
            // Intentar buscar una voz americana nativa
            utterance.voice = voices.find(v => v.lang === 'en-US' && v.name.includes('Google')) || voices[0];
            utterance.rate = 0.95;
            utterance.pitch = 1;
            synth.speak(utterance);
        }

        function startListening() {
            recognition.start();
            micBtn.classList.add('mic-active');
            statusText.innerText = "Listening... speak now!";
        }

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            micBtn.classList.remove('mic-active');
            addMessage(transcript, true);
            statusText.innerText = "Processing...";
            
            // Lógica simple de respuesta "Nativa"
            setTimeout(() => {
                const topic = document.getElementById('topic-selector').value;
                const responses = scenarios[topic];
                const randomResp = "That's interesting! " + responses[Math.floor(Math.random() * responses.length)];
                
                addMessage(randomResp);
                speak(randomResp);
                statusText.innerText = "Ace replied. Your turn!";
            }, 1000);
        };

        recognition.onerror = () => {
            micBtn.classList.remove('mic-active');
            statusText.innerText = "Error. Try again.";
        };

        function changeTopic() {
            const topicName = document.getElementById('topic-selector').options[document.getElementById('topic-selector').selectedIndex].text;
            const msg = `Perfect, let's talk about ${topicName}. What's on your mind?`;
            addMessage(msg);
            speak(msg);
        }

        // Cargar voces
        window.speechSynthesis.onvoiceschanged = () => { console.log("Voices loaded"); };
    </script>
</body>
</html>
